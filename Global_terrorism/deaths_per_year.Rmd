---
title: "deaths_per_year"
author: "Michael Mbajwa"
date: "12/3/2021"
output: pdf_document
---

Objective of this is to develop a Circular Barplot that shows the amount of deaths per decades caused by terrorism from 1973 - 2017.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(broom)
library(purrr)
```

Load the dataset
```{r}
fatalities <- read_csv("/Users/mac/My-R-graph-gallery/Global_terrorism/data/fatalities-from-terrorism.csv")

fatalities %>%
  filter(!(Entity == "International")) %>%
  rename(deaths = "Terrorism fatalities (GTD, 2018)") %>%
  # I will make the column `Year` categorical
  mutate(Year = as.character(Year)) -> fatalities

fatalities
```

Looking at the dataset, Countries are stored under the Entity column. 
We can now look at the different countries in our dataset.

```{r}
fatalities %>%
  select(Entity) %>%
  distinct()
```
Observation: We have a mixture of countries, and continents in our dataset. We also have deuplicated countries. Let's separate these. First of all, I have to manually identify the continents in the dataset. They are:
(Australasia & Oceania, Central America & Caribbean, Central Asia, East Asia, Eastern Europe, International, Middle East & North Africa, North America, South America, South Asia, Southeast Asia, Sub-Saharan Africa, Western Europe)

Knowing these will help us in performing continent specific fatalities.

# Observation
We have a `World` variable in the Entity column. We can simply use this to visualize the global fatalities.
```{r}
fatalities %>%
  filter(Entity == "World") -> world_fatality

world_fatality
```
I want to ensure the data from the World variable equals the data of all the countries of the world summed together. So I will get the fatality by country, group it by year and sum it.
```{r}
fatalities %>%
  filter(!(Entity %in% c("Australasia & Oceania", "Central America & Caribbean", "Central Asia", "East Asia", "Eastern Europe", "Middle East & North Africa", "North America", "South America", "South Asia", "Southeast Asia", "Sub-Saharan Africa", "Western Europe", "Western Sahara", "World"))) -> fatality_by_country

total_by_country <- fatality_by_country %>%
  group_by(Year) %>%
  summarise(deaths = sum(deaths))

total_by_country
```
I then compare the differences.
```{r}
diff_deaths <- tibble(year = world_fatality$Year,
                      deaths_world = world_fatality$deaths,
                      deaths_country = total_by_country$deaths,
                      diff = deaths_world - deaths_country)

diff_deaths
```
# Conclusion
I can conclude both groups of data are similar.


I want to first group by decades
```{r}
world_fatality %>%
  select(c(Year, deaths)) %>%
  mutate(Year = as.double(Year)) %>%
  mutate(Decade = case_when(
    Year %in% c(1970:1979) ~ "1970s",
    Year %in% c(1980:1989) ~ "1980s",
    Year %in% c(1990:1999) ~ "1990s",
    Year %in% c(2000:2009) ~ "2000s",
    Year %in% c(2010:2019) ~ "2010s"
  )) %>%
  group_by(Decade) %>%
  summarise(Deaths = sum(deaths)) -> fatality_by_decade

fatality_by_decade
```

```{r}
library(ggplot2)
library(extrafont)
```



# I can now go ahead to make the Circular Barplot
```{r}
fatality_by_decade %>%
  ggplot() +
  geom_col(aes(x = Decade,
               y = Deaths,
               fill = Deaths),
           position = "dodge2",
           show.legend = TRUE,
           alpha = .9) +
  geom_segment(aes(x = Decade,
               y = 0,
               xend = Decade,
               yend = 200000),
               linetype = "dashed",
               color = "#333333") +
  theme_light() +
  # I transform the chart to a circular chart
  coord_polar() +
  annotate(x = "1970s",
           angle = -35,
           y = 50800,
           label = "50000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
  annotate(x = "1970s",
           angle = -35,
           y = 100800,
           label = "100000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
   annotate(x = "1970s",
           angle = -35,
           y = 150800,
           label = "150000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
  annotate(x = "1970s",
           angle = -35,
           y = 200000,
           label = "200000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
  # I scale the y-axis so the chart doesn't start from the bottom
  scale_y_continuous(limits = c(-60000, 200000), 
                     expand = c(0, 0)) +
  # I can now fill the legend for number of deaths per decade
  scale_fill_gradientn("Number of fatalities",
                       colours = c("#f38375", "#ef6351", "#e5383b", "#ba0c0c")) +
  # I will make the color guide discrete
  guides(fill = guide_colorsteps(barwidth = 20, barheight = 2.0, 
                                 title.position = "top", title.hjust = .5)) +
  theme(legend.position = "bottom",
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(color = "gray12", size = 18, face = "bold"),
        legend.text = element_text(size = 15),
        legend.title = element_text(size = 18, face = "italic"))  +
  # add labels
  labs(title = "The Menance of Global Terrorism",
    subtitle = "Visualization by Michael Mbajwa - michaelmbajwa@gmail.com\n\nThis visualization aims to show the global death toll\nfrom terrorism over the past four decades (1970-2017).\n",
    caption = "Source: https://ourworldindata.org") +
  # Customize general theme
  theme(text = element_text(color = "gray12", family = "serif"),
    plot.title = element_text(face="bold", size = 25, hjust = 0.5, color="#bb0a21"),
    plot.subtitle = element_text(size = 19, hjust = 0.5, face = "italic"),
    plot.caption = element_text(size = 18, hjust = .5, face = "italic")) -> plt
```

```{r}
ggsave("plot.png", plt,width=9, height=12.6)
```


