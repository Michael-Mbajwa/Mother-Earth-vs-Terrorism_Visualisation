---
title: "deaths_per_year"
author: "Michael Mbajwa"
date: "12/3/2021"
output: pdf_document
---

TITLE: Mother Nature vs Terrorism : Which should scare us more?

Objective of my visualization is to compare the deaths caused by mother nature against that caused by Terrorism across the globe.

More background would be provided. But for now the rough idea is basically me showing reasons why much care should be given to mitigate natural disasters as has been given to the much more violent terrorism.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(broom)
library(purrr)
library(plotly)
library(stringr)
```

Load the datasets
```{r}
deaths_terrorism <- read_csv("data/fatalities-from-terrorism.csv")

deaths_disasters <- read_csv("data/number-of-deaths-from-natural-disasters.csv")

deaths_terrorism
```


# Effort 1
# I will start with the deaths by terrorism dataset
```{r}
deaths_terrorism <- deaths_terrorism %>%
  filter(!(Entity == "International")) %>%
  rename(deaths = "Terrorism fatalities (GTD, 2018)") %>%
  # I will make the column `Year` categorical
  mutate(Year = as.character(Year))

deaths_terrorism
```

Looking at the dataset, Countries are stored under the Entity column. 
We can now look at the different countries in our dataset.

```{r}
deaths_terrorism %>%
  select(Entity) %>%
  distinct()
```
Observation: We have a mixture of countries, and continents in our dataset. We also have deuplicated countries. Let's separate these. First of all, I have to manually identify the continents in the dataset. They are:
(Australasia & Oceania, Central America & Caribbean, Central Asia, East Asia, Eastern Europe, International, Middle East & North Africa, North America, South America, South Asia, Southeast Asia, Sub-Saharan Africa, Western Europe)

Knowing these will help us in performing continent specific fatalities.

# Observation
We have a `World` variable in the Entity column. We can simply use this to visualize the global fatalities.
```{r}
deaths_terrorism %>%
  filter(Entity == "World") -> global_deaths_terro

global_deaths_terro
```
I want to ensure the data from the World variable equals the data of all the countries of the world summed together. So I will get the fatality by country, group it by year and sum it.
```{r}
deaths_terrorism %>%
  filter(!(Entity %in% c("Australasia & Oceania", "Central America & Caribbean", "Central Asia", "East Asia", "Eastern Europe", "Middle East & North Africa", "North America", "South America", "South Asia", "Southeast Asia", "Sub-Saharan Africa", "Western Europe", "Western Sahara", "World"))) %>% group_by(Year) %>%
  summarise(deaths = sum(deaths)) -> deaths_terro_country

deaths_terro_country
```

I then compare the differences.
```{r}
diff_deaths <- tibble(year = global_deaths_terro$Year,
                      deaths_world = global_deaths_terro$deaths,
                      deaths_country = deaths_terro_country$deaths,
                      diff = deaths_world - deaths_country)

diff_deaths
```
# Conclusion
I can conclude both groups of data are similar. The data can be trusted


I want to first group by decades
```{r}
global_deaths_terro %>%
  select(c(Year, deaths)) %>%
  mutate(Year = as.double(Year)) %>%
  mutate(Decade = case_when(
    Year %in% c(1970:1979) ~ "1970s",
    Year %in% c(1980:1989) ~ "1980s",
    Year %in% c(1990:1999) ~ "1990s",
    Year %in% c(2000:2009) ~ "2000s",
    Year %in% c(2010:2019) ~ "2010s"
  )) %>%
  group_by(Decade) %>%
  summarise(Deaths = sum(deaths)) -> decadal_terro_death

decadal_terro_death
```

# I can now go ahead to make the Circular Barplot
```{r}
decadal_terro_death %>%
  ggplot() +
  geom_col(aes(x = Decade,
               y = Deaths,
               fill = Deaths),
           position = "dodge2",
           show.legend = TRUE,
           alpha = .9) +
  geom_segment(aes(x = Decade,
               y = 0,
               xend = Decade,
               yend = 200000),
               linetype = "dashed",
               color = "#333333") +
  theme_light() +
  # I transform the chart to a circular chart
  coord_polar() +
  # Manual annotations to replace the y-axis. Will help in showing amount of deaths for each polar axis
  annotate(x = "1970s",
           angle = -35,
           y = 50800,
           label = "50000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
  annotate(x = "1970s",
           angle = -35,
           y = 100800,
           label = "100000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
   annotate(x = "1970s",
           angle = -35,
           y = 150800,
           label = "150000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
  annotate(x = "1970s",
           angle = -35,
           y = 200000,
           label = "200000",
           geom = "text",
           color = "gray12",
           family = "serif",
           size = 6.5) +
  # I scale the y-axis so the chart doesn't start from the bottom
  scale_y_continuous(limits = c(-60000, 200000), 
                     expand = c(0, 0)) +
  # I can now fill the legend for number of deaths per decade
  scale_fill_gradientn("Number of fatalities",
                       colours = c("#f38375", "#ef6351", "#e5383b", "#ba0c0c")) +
  # I will make the color guide discrete
  guides(fill = guide_colorsteps(barwidth = 20, barheight = 2.0, 
                                 title.position = "top", title.hjust = .5)) +
  theme(legend.position = "bottom",
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(color = "gray12", size = 18, face = "bold"),
        legend.text = element_text(size = 15),
        legend.title = element_text(size = 18, face = "italic"))  +
  # add labels
  labs(title = "The Menance of Terrorism",
    subtitle = "\nThis visualization aims to show the decadal global death toll caused by terrorism.\n",
    caption = "Source: https://ourworldindata.org") +
  # Customize general theme
  theme(text = element_text(color = "gray12", family = "serif"),
    plot.title = element_text(face="bold", size = 25, hjust = 0.5, color="#bb0a21"),
    plot.subtitle = element_text(size = 19, hjust = 0.5, face = "italic"),
    plot.caption = element_text(size = 18, hjust = .5, face = "italic")) -> plot1
```


```{r}
ggsave("data/plot.png", plot1,width=9, height=12.6)
```


# Display of the plot result
```{r, echo=FALSE, out.width="50%", fig.cap="The Menance of Terrorism"}
knitr::include_graphics("data/plot.png")
```


# Effort 2: Global deaths from Natural Disasters

I would like to plot a bubble chart that shows the death toll caused by Natural disasters from 1900-2020. I will use plotly to add tooltips at the end of the chart.

# Explore the dataset to identify simple analysis to perform
```{r}
deaths_disasters
```
# Observations: Since I want to plot the global death toll, I will extract World from Entity. I would also like to remove deaths_ from each column.


```{r}
deaths_disasters %>%
  # Select only world data
  filter(Entity == "World") %>%
  # Remove each columns
  rename_with(~str_to_title(sub(".*_", "", .x))) %>%
  # Remove column code
  select(!(Code)) %>%
  # Pivot dataset to simplify analysis
  pivot_longer(Earthquake:Wildfire, names_to = "Type", values_to = "Deaths") %>%
  # Data in column is originally scattered. It affects visualisation. Rearranged
  arrange(Year) %>%
  # I use fct to order how disaster types are displayed on the plot
  # Create a text column to be used as a tooltip
  mutate(Type = fct_reorder(Type, desc(Type)),
         text = paste("Year:", Year,"\nType:", Type, "\nDeaths:", Deaths, sep = "")) -> global_death_disasters


global_death_disasters
```

# Plot the bubble chart

```{r}
global_death_disasters %>%
  ggplot(aes(x = Year, y = Type, size=Deaths, color=Type, text = text))+
  geom_point(alpha=0.5) +
  # Manually select colors for each disaster type
  scale_color_manual(values = c("Earthquake" = "#d2601a",
                                "Drought" = "#184e77",
                                "Wildfire" = "#cb0b0a",
                                "Movement" = "#006d77",
                                "Temperature" = "#6d597a",
                                "Flood" = "#4cc9f0",
                                "Landslide" = "#80b918",
                                "Storm" = "#1d3c45",
                                "Volcanic" = "#8e0413")) +
  scale_size(range = c(1.1, 12)) +
  labs(title = "Global death toll from Natural disasters (1900-2016).",
       subtitle = "The size of the bubble represents the total death count per year, for each disaster type.",
       caption = "\n\nData source: https://ourworldindata.org",
       y = NULL,
       x = NULL) +
  theme_classic() +
  # Fine tune the rest of the chart
  theme(axis.text.x = element_text(color="#000000"),
        axis.text.y = element_text(color="#000000"),
        legend.position = "none",
        text = element_text(color = "gray12", family = "serif"),
        plot.title = element_text(face="bold", size = 13, hjust = 0.5,
                                  color="#000000"),
        plot.subtitle = element_text(size = 8, face = "italic", hjust = 0.5),
        plot.caption = element_text(size = 7, hjust = 1, face = "italic", 
                                    color = "blue"),
        axis.ticks.y = element_blank(),
        axis.line.y = element_blank()) -> plot2
```


# Display the plot result as a png file
```{r, echo=FALSE, fig.cap="The Menance of Terrorism"}
knitr::include_graphics("data/plot2.png")
```


# Interactive plot with plotly
```{r}
ggplotly(plot2, tooltip ="text")
```


# Effort 3



